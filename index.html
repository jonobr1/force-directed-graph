<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf8">

    <!-- Primary Meta Tags -->
    <title>Force Directed Graph</title>
    <meta name="title" content="FDG — Force Directed Graph">
    <meta name="description" content="GPU supercharged attraction-graph visualizations for the web built on top of Three.js.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jonobr1.com/force-directed-graph">
    <meta property="og:title" content="FDG — Force Directed Graph">
    <meta property="og:description" content="GPU supercharged attraction-graph visualizations for the web built on top of Three.js.">
    <meta property="og:image" content="https://jonobr1.com/force-directed-graph/thumbnail.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://metatags.io/">
    <meta property="twitter:title" content="FDG — Force Directed Graph">
    <meta property="twitter:description" content="GPU supercharged attraction-graph visualizations for the web built on top of Three.js.">
    <meta property="twitter:image" content="https://jonobr1.com/force-directed-graph/thumbnail.png">

    <meta name="viewport" content="width=device-width, user-scalable=no">
    <link rel="icon" type="image/png" href="./favicon.png" />

    <style>

      * { margin: 0; padding: 0; }
      body {
        font-family: "Lucida Bright", "Times New Roman", Times, serif;
        font-size: 20px;
        line-height: 1.5;
        color: #333;
      }
      .symbols {
        font-family: webdings;
      }
      svg, canvas {
        display: block;
      }
      div#stage {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
      }
      div.content {
        padding: 20px;
        padding-top: 80px;
        pointer-events: none;
      }
      p {
        padding-top: 20px;
      }
      ul li {
        display: inline-block;
      }
      ul li + li:before {
        content: " • ";
      }
      div.scripts {
        display: none;
      }
      div.column {
        display: inline-block;
        position: relative;
        vertical-align: top;
        min-width: 300px;
      }
      a {
        color: #333;
        text-decoration: none;
        border-bottom: 1px solid #111;
        pointer-events: auto;
      }
      h1, h2, h3, h4, h5, h6 {
        font-weight: 100;
      }
      p {
        max-width: 600px;
      }
      p + p {
        margin-top: 10px;
      }
      ul {
        margin-bottom: 20px;
      }
      .explanation {
        cursor: help;
      }
      .action {
        font-style: italic;
        cursor: pointer;
        border-bottom: 1px solid #333;
      }
      .nota-bene {
        font-style: italic;
        border-left: 4px solid orange;
        padding-left: 10px;
        margin-left: -10px;
      }
      .hidden {
        display: none;
      }

    </style>
  </head>
  <body>
    <div id="stage"></div>
    <div class="content column">
      <h1 id="title">
        Force Directed Graph
      </h1>
      <p id="links">
          <a href="https://npmjs.com/package/@jonobr1/force-directed-graph">NPM</a> &middot; <a href="http://github.com/jonobr1/force-directed-graph">Source Code</a> &middot; <a href="https://github.com/jonobr1/force-directed-graph/blob/master/LICENSE" target="_blank">MIT</a>
        </p>
      <p>
        GPU supercharged attraction-graph visualizations for the web built on top of <a href="http://threejs.org">Three.js</a>. Importable as an ES6 module. In this demo you can click and drag the visualization to rotate the camera.
      </p>
      <p>
        Check out this demo with different particle counts:
        <ul>
          <li><a href="./?amount=250">250 Nodes</a></li>
          <li><a href="./?amount=1000">1k Nodes</a></li>
          <li><a href="./?amount=5000">5k Nodes</a></li>
          <li><a href="./?amount=10000">10k Nodes</a></li>
          <li><a href="https://codepen.io/collection/YyQjom">More examples</a></li>
        </ul>
      </p>
      <p id="post-scriptum">
        Created <span id="created-date"></span> and updated <span id="updated-date"></span>.
        <br />
        A free and open source tool by <a href="http://jono.fyi/" target="_blank">Jono Brandel</a>
        <br />
      </p>
      <div id="gui"></div>
    </div>
    <div class="scripts">
      <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
      <script type="importmap">
        {
          "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three/build/three.module.js",
            "three/examples/jsm/misc/GPUComputationRenderer.js": "https://cdn.jsdelivr.net/npm/three/examples/jsm/misc/GPUComputationRenderer.js",
            "three/examples/jsm/controls/OrbitControls.js": "https://cdn.jsdelivr.net/npm/three/examples/jsm/controls/OrbitControls.js",
            "lil-gui": "https://cdn.jsdelivr.net/npm/lil-gui/dist/lil-gui.esm.js",
            "@jonobr1/force-directed-graph": "./src/index.js"
          }
        }
      </script>
      <script type="module">

        import * as THREE from 'three';
        import { GUI } from 'lil-gui';
        import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'
        import { ForceDirectedGraph } from '@jonobr1/force-directed-graph';

        const BLEND_MODES = {
          Normal: THREE.NormalBlending,
          Additive: THREE.AdditiveBlending,
          Subtractive: THREE.SubtractiveBlending,
          Multiply: THREE.MultiplyBlending
        };

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera();
        const controls = new OrbitControls(camera, renderer.domElement);
        const fog = new THREE.Fog(0xffffff, 200, 750);
        const mouse = new THREE.Vector2(-2, -2);
        const fdg = new ForceDirectedGraph(renderer, { shaderType: 'nested' });

        scene.fog = fog;
        controls.enableDamping = true;
        camera.position.z = 250;

        const qp = new URLSearchParams(window.location.search);
        const amount = +(qp.get('amount') || 1000);
        const data = {"nodes":[{"id":0},{"id":1},{"id":2},{"id":3},{"id":4},{"id":5},{"id":6},{"id":7},{"id":8},{"id":9},{"id":10},{"id":11},{"id":12},{"id":13},{"id":14},{"id":15},{"id":16},{"id":17},{"id":18},{"id":19},{"id":20},{"id":21},{"id":22},{"id":23},{"id":24},{"id":25},{"id":26},{"id":27},{"id":28},{"id":29},{"id":30},{"id":31},{"id":32},{"id":33},{"id":34},{"id":35},{"id":36},{"id":37},{"id":38},{"id":39},{"id":40},{"id":41},{"id":42},{"id":43},{"id":44},{"id":45},{"id":46},{"id":47},{"id":48},{"id":49},{"id":50},{"id":51},{"id":52},{"id":53},{"id":54},{"id":55},{"id":56},{"id":57},{"id":58},{"id":59},{"id":60},{"id":61},{"id":62},{"id":63},{"id":64},{"id":65},{"id":66},{"id":67},{"id":68},{"id":69},{"id":70},{"id":71},{"id":72},{"id":73},{"id":74},{"id":75},{"id":76},{"id":77},{"id":78},{"id":79},{"id":80},{"id":81},{"id":82},{"id":83},{"id":84},{"id":85},{"id":86},{"id":87},{"id":88},{"id":89},{"id":90},{"id":91},{"id":92},{"id":93},{"id":94},{"id":95},{"id":96},{"id":97},{"id":98},{"id":99},{"id":100},{"id":101},{"id":102},{"id":103},{"id":104},{"id":105},{"id":106},{"id":107},{"id":108},{"id":109},{"id":110},{"id":111},{"id":112},{"id":113},{"id":114},{"id":115},{"id":116},{"id":117},{"id":118},{"id":119},{"id":120},{"id":121},{"id":122},{"id":123},{"id":124},{"id":125},{"id":126},{"id":127},{"id":128},{"id":129},{"id":130},{"id":131},{"id":132},{"id":133},{"id":134},{"id":135},{"id":136},{"id":137},{"id":138},{"id":139},{"id":140},{"id":141},{"id":142},{"id":143},{"id":144},{"id":145},{"id":146},{"id":147},{"id":148},{"id":149},{"id":150},{"id":151},{"id":152},{"id":153},{"id":154},{"id":155},{"id":156},{"id":157},{"id":158},{"id":159},{"id":160},{"id":161},{"id":162},{"id":163},{"id":164},{"id":165},{"id":166},{"id":167},{"id":168},{"id":169},{"id":170},{"id":171},{"id":172},{"id":173},{"id":174},{"id":175},{"id":176},{"id":177},{"id":178},{"id":179},{"id":180},{"id":181},{"id":182},{"id":183},{"id":184},{"id":185},{"id":186},{"id":187},{"id":188},{"id":189},{"id":190},{"id":191},{"id":192},{"id":193},{"id":194},{"id":195},{"id":196},{"id":197},{"id":198},{"id":199},{"id":200},{"id":201},{"id":202},{"id":203},{"id":204},{"id":205},{"id":206},{"id":207},{"id":208},{"id":209},{"id":210},{"id":211},{"id":212},{"id":213},{"id":214},{"id":215},{"id":216},{"id":217},{"id":218},{"id":219},{"id":220},{"id":221},{"id":222},{"id":223},{"id":224},{"id":225},{"id":226},{"id":227},{"id":228},{"id":229},{"id":230},{"id":231},{"id":232},{"id":233},{"id":234},{"id":235},{"id":236},{"id":237},{"id":238},{"id":239},{"id":240},{"id":241},{"id":242},{"id":243},{"id":244},{"id":245},{"id":246},{"id":247},{"id":248},{"id":249}],"links":[{"target":1,"source":0},{"target":2,"source":1},{"target":0,"source":3},{"target":4,"source":3},{"target":5,"source":4},{"target":6,"source":5},{"target":3,"source":7},{"target":0,"source":8},{"target":1,"source":9},{"target":0,"source":10},{"target":11,"source":10},{"target":9,"source":12},{"target":8,"source":13},{"target":14,"source":13},{"target":15,"source":14},{"target":12,"source":16},{"target":1,"source":17},{"target":15,"source":18},{"target":13,"source":19},{"target":20,"source":19},{"target":21,"source":20},{"target":22,"source":21},{"target":23,"source":22},{"target":18,"source":24},{"target":6,"source":25},{"target":26,"source":25},{"target":27,"source":26},{"target":2,"source":28},{"target":5,"source":29},{"target":30,"source":29},{"target":31,"source":30},{"target":2,"source":32},{"target":4,"source":33},{"target":34,"source":33},{"target":1,"source":35},{"target":29,"source":36},{"target":37,"source":36},{"target":35,"source":38},{"target":33,"source":39},{"target":10,"source":40},{"target":5,"source":41},{"target":38,"source":42},{"target":43,"source":42},{"target":10,"source":44},{"target":45,"source":44},{"target":46,"source":45},{"target":33,"source":47},{"target":48,"source":47},{"target":4,"source":49},{"target":2,"source":50},{"target":21,"source":51},{"target":30,"source":52},{"target":53,"source":52},{"target":54,"source":53},{"target":18,"source":55},{"target":42,"source":56},{"target":57,"source":56},{"target":58,"source":57},{"target":59,"source":58},{"target":57,"source":60},{"target":61,"source":60},{"target":46,"source":62},{"target":57,"source":63},{"target":64,"source":63},{"target":65,"source":64},{"target":54,"source":66},{"target":4,"source":67},{"target":68,"source":67},{"target":69,"source":68},{"target":70,"source":69},{"target":71,"source":70},{"target":72,"source":71},{"target":73,"source":72},{"target":74,"source":73},{"target":0,"source":75},{"target":76,"source":75},{"target":77,"source":76},{"target":78,"source":77},{"target":79,"source":78},{"target":80,"source":79},{"target":81,"source":80},{"target":82,"source":81},{"target":83,"source":82},{"target":42,"source":84},{"target":85,"source":84},{"target":16,"source":86},{"target":52,"source":87},{"target":88,"source":87},{"target":89,"source":88},{"target":0,"source":90},{"target":91,"source":90},{"target":92,"source":91},{"target":44,"source":93},{"target":94,"source":93},{"target":95,"source":94},{"target":53,"source":96},{"target":97,"source":96},{"target":98,"source":97},{"target":14,"source":99},{"target":100,"source":99},{"target":14,"source":101},{"target":93,"source":102},{"target":49,"source":103},{"target":104,"source":103},{"target":105,"source":104},{"target":106,"source":105},{"target":73,"source":107},{"target":51,"source":108},{"target":107,"source":109},{"target":52,"source":110},{"target":111,"source":110},{"target":32,"source":112},{"target":10,"source":113},{"target":114,"source":113},{"target":115,"source":114},{"target":116,"source":115},{"target":114,"source":117},{"target":118,"source":117},{"target":67,"source":119},{"target":104,"source":120},{"target":53,"source":121},{"target":122,"source":121},{"target":123,"source":122},{"target":78,"source":124},{"target":125,"source":124},{"target":126,"source":125},{"target":127,"source":126},{"target":99,"source":128},{"target":129,"source":128},{"target":1,"source":130},{"target":131,"source":130},{"target":88,"source":132},{"target":133,"source":132},{"target":134,"source":133},{"target":135,"source":134},{"target":135,"source":136},{"target":53,"source":137},{"target":129,"source":138},{"target":4,"source":139},{"target":140,"source":139},{"target":141,"source":140},{"target":104,"source":142},{"target":132,"source":143},{"target":144,"source":143},{"target":145,"source":144},{"target":22,"source":146},{"target":147,"source":146},{"target":148,"source":147},{"target":80,"source":149},{"target":46,"source":150},{"target":151,"source":150},{"target":152,"source":151},{"target":92,"source":153},{"target":121,"source":154},{"target":126,"source":155},{"target":79,"source":156},{"target":113,"source":157},{"target":158,"source":157},{"target":118,"source":159},{"target":160,"source":159},{"target":86,"source":161},{"target":132,"source":162},{"target":163,"source":162},{"target":4,"source":164},{"target":165,"source":164},{"target":66,"source":166},{"target":69,"source":167},{"target":168,"source":167},{"target":169,"source":168},{"target":170,"source":169},{"target":68,"source":171},{"target":103,"source":172},{"target":173,"source":172},{"target":142,"source":174},{"target":175,"source":174},{"target":176,"source":175},{"target":177,"source":176},{"target":43,"source":178},{"target":1,"source":179},{"target":162,"source":180},{"target":181,"source":180},{"target":182,"source":181},{"target":183,"source":182},{"target":184,"source":183},{"target":185,"source":184},{"target":186,"source":185},{"target":187,"source":186},{"target":188,"source":187},{"target":166,"source":189},{"target":165,"source":190},{"target":191,"source":190},{"target":192,"source":191},{"target":193,"source":192},{"target":194,"source":193},{"target":137,"source":195},{"target":142,"source":196},{"target":134,"source":197},{"target":108,"source":198},{"target":37,"source":199},{"target":200,"source":199},{"target":201,"source":200},{"target":202,"source":201},{"target":140,"source":203},{"target":204,"source":203},{"target":52,"source":205},{"target":149,"source":206},{"target":139,"source":207},{"target":208,"source":207},{"target":209,"source":208},{"target":15,"source":210},{"target":33,"source":211},{"target":39,"source":212},{"target":91,"source":213},{"target":160,"source":214},{"target":215,"source":214},{"target":173,"source":216},{"target":182,"source":217},{"target":218,"source":217},{"target":55,"source":219},{"target":220,"source":219},{"target":105,"source":221},{"target":36,"source":222},{"target":66,"source":223},{"target":125,"source":224},{"target":225,"source":224},{"target":226,"source":225},{"target":227,"source":226},{"target":228,"source":227},{"target":229,"source":228},{"target":90,"source":230},{"target":231,"source":230},{"target":232,"source":231},{"target":105,"source":233},{"target":234,"source":233},{"target":137,"source":235},{"target":236,"source":235},{"target":27,"source":237},{"target":238,"source":237},{"target":190,"source":239},{"target":182,"source":240},{"target":112,"source":241},{"target":242,"source":241},{"target":243,"source":242},{"target":221,"source":244},{"target":245,"source":244},{"target":246,"source":245},{"target":116,"source":247},{"target":248,"source":247},{"target":249,"source":248}]}
        // const data = {
        //   nodes: [],
        //   links: []
        // };

        // for (let i = 0; i < amount; i++) {

        //   data.nodes.push({ id: i });

        //   const target = Math.floor(Math.random() * i);
        //   const source = i;

        //   if (i > 0 && Math.random() > 0.5) {
        //     data.links.push({ target: i, source: i - 1 });
        //   } else if (target !== source) {
        //     data.links.push({
        //       target,
        //       source
        //     });
        //   }

        // }

        // console.log(JSON.stringify(data));

        let gui;

        fdg.set(data).then(setup);

        function setup() {

          gui = new GUI();

          fdg.pointColor.setRGB(0.3, 0.3, 0.3);
          fdg.linkColor.setRGB(0.9, 0.9, 0.9);

          gui.close();

          [
            { name: 'decay', min: 0, max: 1, step: 0.001 },
            { name: 'maxSpeed', min: 0, max: 25, step: 1 },
            { name: 'timeStep', min: 0, max: 2, step: 0.1 },
            { name: 'damping', min: 0, max: 1, step: 0.1 },
            { name: 'repulsion', min: -2, max: 2, step: 0.1 },
            { name: 'springLength', min: 0, max: 10, step: 0.5 },
            { name: 'stiffness', min: 0, max: 1, step: 0.1 },
            { name: 'nodeRadius', min: 0, max: 5, step: 0.5 },
            { name: 'nodeScale', min: 0, max: 50, step: 0.1 },
            { name: 'gravity', min: 0, max: 1, step: 0.1 },
            { name: 'opacity', min: 0, max: 1, step: 0.1 }
          ].forEach(function({ name, min, max, step }) {

            gui.add(fdg, name, min, max, step).name(name).onChange(reset);

          });

          gui.add(fdg, 'sizeAttenuation').onChange(reset);
          gui.add(fdg, 'is2D').name('2D').onChange(reset);
          gui.add({ blending: THREE.NormalBlending }, 'blending', BLEND_MODES)
            .onChange(function(v) {
              fdg.blending = v;
              reset();
            });

          const folders = {
            points: gui.addFolder('Points'),
            links: gui.addFolder('Links')
          };

          folders.points.add(fdg.points, 'visible').name('visible');
          folders.points.add(fdg, 'pointsInheritColor').name('inheritColors');
          folders.points.addColor(fdg, 'pointColor').name('color');

          folders.links.add(fdg.links, 'visible').name('visible');
          folders.links.add(fdg, 'linksInheritColor').name('inheritColor');
          folders.links.addColor(fdg, 'linkColor').name('color');

          scene.add(fdg);

          updateStats();

          renderer.setClearColor('#fff');
          document.querySelector('#stage').appendChild(renderer.domElement);
          window.addEventListener('resize', resize, false);

          renderer.domElement.addEventListener('pointermove', pointermove, false);

          resize();

          renderer.setAnimationLoop(render);

        }

        function resize() {

          const width = window.innerWidth;
          const height = window.innerHeight;

          renderer.setSize(width, height);
          camera.aspect = width / height;
          camera.updateProjectionMatrix();

        }

        function pointermove(e) {
          const x = e.clientX / window.innerWidth;
          const y = e.clientY / window.innerHeight;
          mouse.set(x, y);
        }

        function render(elapsed) {
          controls.update();
          fdg.update(elapsed);
          renderer.render(scene, camera);
        }

        function reset() {
          fdg.alpha = 1;
        }

        function updateStats() {

          var xhr = new XMLHttpRequest();
          xhr.open('GET', 'https://api.github.com/repos/jonobr1/force-directed-graph');
          xhr.onreadystatechange = function() {
            if (!(xhr.readyState === 4 && xhr.status === 200)) {
              return;
            }
            var resp = JSON.parse(xhr.responseText);
            document.querySelector('#updated-date').textContent = formatDate(resp.pushed_at);
            document.querySelector('#created-date').textContent = formatDate(resp.created_at);
          };
          xhr.send();

        }

        function formatDate(time) {
          var date = new Date(time);
          var suffices = ['st', 'nd', 'rd'];
          suffices.getIndex = function(n) {
            var index = parseInt((n + '').slice(-1));
            return index - 1;
          };
          var months = ['January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'];
          return [
            months[date.getMonth()],
            date.getDate() + ',',
            date.getFullYear()
          ].join(' ')
        }

      </script>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-C0Y38714D6"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-C0Y38714D6');
      </script>
    </div>
  </body>
</html>
